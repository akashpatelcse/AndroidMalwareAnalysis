#adb shell monkey -p com.keji.danti603 -c android.intent.category.LAUNCHER 10

import os
import sys
from androguard.misc import AnalyzeAPK
import time


apkFolders = ["MalwareApks/", "GoodwareApks"]
apkFiles = apkFolders[0] #malware 0 , goodware 1


APKs = []
for name in os.listdir(apkFiles):
    if os.path.isfile(os.path.join(apkFiles, name)):
        APKs.append(name)


def getPkgName(apk):
	a, d, dx = AnalyzeAPK(apk)
	package_name = a.get_package()
	print(package_name)
	return package_name

def runApp(pkgName):
	command = "adb shell monkey -p" + pkgName + " -c android.intent.category.LAUNCHER 100"
	for i in range(5):
		os.system(command)
		print("Triggered %d time", i)
		time.sleep(1)
	os.system("adb uninstall " + str(pkgName))
	print("Apk Uninstalled")



def installApp(apk):
	pkgName = getPkgName(apk)
	os.system("adb install "+ apk)
	time.sleep(2)
	runApp(pkgName)


for i in APKs:
	apk = apkFiles+i
	os.rename(apk, apk+".apk")
	installApp(apk+".apk")
	os.rename(apk+".apk", apkFiles+i)
