import os
import sys

'''
    Created By: Akash Patel (akashpatelcse)
                MTECH (CSE) IIT Kanpur
                https://in.linkedin.com/in/akashpatelcse
'''

apkType = sys.argv[1].strip()
#apkType = "Derbin"
#apkType = "Andro"

cla = 0   #0->goodware, 1->malware

if apkType == "Derbin":
	cla = 1
else:
	cla = 0


folders = ["Andro_FilteredCSV/", "Derbin_FilteredCSV/" ]
FrequencyFile = ["AndroguardFrequencyFile.csv", "DerbinFrequencyFile.csv"]

apiCallsDict = {}

def readFromFile(f):
	print(".")
	lines = open(f, 'r').readlines()
	visitedApiCall = set()
	for line in lines:
		apicall = list(line.split(','))[0]
		if apicall in visitedApiCall:
			continue
		visitedApiCall.add(apicall)
		if apicall in apiCallsDict.keys():
			apiCallsDict[apicall] += 1
		else:
			apiCallsDict[apicall] = 1

def process(folder):
	print(folder)
	csvFiles = []
	for name in os.listdir(folder):
		if os.path.isfile(os.path.join(folder, name)):
			csvFiles.append(name)

	for file in csvFiles:
		readFromFile(folder+file)
		#break
	
print("Starting")
process(folders[cla])

f = open(FrequencyFile[cla], 'w')
for i in apiCallsDict.keys():
	if(apiCallsDict[i] > 20):							#Ignoring API calls came into less than 20 apps
		f.write(i + "," + str(apiCallsDict[i]) + "\n")
f.close()
