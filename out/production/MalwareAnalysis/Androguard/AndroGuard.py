#python3 AndroGuard.py Facebook.com

import re
from androguard.misc import AnalyzeAPK
import sys


apkfile = str(sys.argv[1])

print("Loading APK: " + apkfile)
print("APK Loaded")

a, d, dx = AnalyzeAPK(apkfile)
permissions = a.get_permissions()
activities = a.get_activities()
app_name = a.get_app_name()
package_name = a.get_package()
version_name = a.get_androidversion_name()
version_code = a.get_androidversion_code()
min_sdk_version = a.get_min_sdk_version()
max_sdk_version = a.get_max_sdk_version()
target_sdk_version = a.get_target_sdk_version()
effective_target_sdk_version = a.get_effective_target_sdk_version()

print("Extracted\n")

f = open("Analysis_"+apkfile.replace(".apk", "")+".txt", "w")

print("File Opened\n")
f.write(str("AppName: " + app_name + "\t"))
f.write(str("package_name: " + package_name + "\n"))
f.write("Version_name: " + str( version_name)+ "\t")
f.write("Version_Code: " + str( version_code)+ "\n")
f.write("min_sdk_version: " + str( min_sdk_version)+ "\t")
f.write("max_sdk_version: " + str( max_sdk_version)+ "\n")
f.write("target_sdk_version: " + str(target_sdk_version)+ "\t")
f.write("effective_target_sdk_version: " + str(effective_target_sdk_version)+ "\n")

f.write("\n\nActivities:\n")
for i in activities:
	f.write("\t\t"+str(i)+"\n")

f.write("\n\nPermissions:\n")
for i in permissions:
	f.write("\t\t"+str(i)+"\n")



#Intent-Filters

def printIntentFilters(itemtype, name, f):
    f.write('\t' + name + ':'+ "\n")
    for action,intent_name in a.get_intent_filters(itemtype, name).items():
                f.write('\t\t' + action + ':\n')
                for intent in intent_name:
                        f.write('\t\t\t' + intent + "\n")
    return

# Intent filters 
f.write('\nServices and their intent-filters:\n')

services = a.get_services()
serviceString = 'service'
for service in services:
    printIntentFilters(serviceString, service, f)


f.write('\nReceivers and their intent-filters:\n')
receivers = a.get_receivers()
receiverString = 'receiver'
for receiver in receivers:
    printIntentFilters(receiverString, receiver, f)


f.close()
print("File Closed")
