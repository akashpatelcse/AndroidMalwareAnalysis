import os
import sys

'''
    Created By: Akash Patel (akashpatelcse)
                MTECH (CSE) IIT Kanpur
                https://in.linkedin.com/in/akashpatelcse
'''

print("Starting Program to Create CSV file from Filtered_CSV_Files:")
apkType = sys.argv[1].strip()


label = str()
Filtered_CSV_Files = str()

CSVFileName = "CSVfile.csv"
if apkType == "Derbin":
    label = "M"
    Filtered_CSV_Files = "Derbin_FilteredCSV/"
else:
    label = "G"
    Filtered_CSV_Files = "Andro_FilteredCSV/"

apiCalls = list(i.strip("\n") for i in open("allCalls.csv", 'r').readlines())
for i in apiCalls:
	print(i)

if len(open(CSVFileName,'r').readlines()) < 2:
	f = open(CSVFileName, 'w')
	for i in apiCalls:
		f.write(i+",")
	f.write("label\n")
	f.close

def process(file):
	dist = {}
	for call in apiCalls:
		dist[call] = 0.0
	lines = open(file, 'r').readlines()
	for line in lines:
		arr = list(line.strip('\n').split(","))
		if arr[0] in dist.keys():
			dist[arr[0]] = float(arr[1])
	csvFile = open(CSVFileName, 'a');
	for call in apiCalls:
		csvFile.write(str(float(dist[call])) + ",")
	csvFile.write(label+"\n")
	csvFile.close()



CSVs = []
for name in os.listdir(Filtered_CSV_Files):
    if os.path.isfile(os.path.join(Filtered_CSV_Files, name)):
        CSVs.append(name)


count = int(0)
for csvFile in CSVs:
    print("\n" + str(count))
    count += 1
    process(Filtered_CSV_Files + csvFile)
  



